{% extends 'base/base.html' %}
{% load static %}
{% load humanize %}
{% block content %}

<div class="w-full m-auto p-1">
  {% if empty_dashboard %}
  <strong>
    You do not have a dashboard Yet
  </strong>
  {% else %}
  <!-- THIS DISPLAYS THE GRAPH -->
  <div id="chartdiv" class="w-full h-[500px] mb-10"> </div>
  <div>
    <!-- THIS DISPLAYS DIFFERENT GOOD USER BUYS AND CAN CLICK IT TO FILTER -->
    <div class="mb-4">
      <button class="m-1">
        <a href="{% url 'dashboard' %}">
          <span id="chart" class="text-center px-2 inline-block">All</span>
        </a>
      </button>

      {% for user_good in user_goods %}
      <button class="m-1">
        <a href="{% url 'dashboard' %}?q={{ user_good.item }}">
          <span id="chart" class="text-center px-0 inline-block">{{ user_good.item }}</span>
        </a>
      </button>
      {% endfor %}
    </div>

    <table class="w-full border-solid border-2 border-black-500 ">
      <caption class="mb-2 font-bold">
        Recent Purchases
      </caption>
      <tr>
        <th>Date</th>
        <th>Item</th>
        <th>Mass (kg)</th>
        <th>Price (&#8358;)</th>
        <th>Note </th>
      </tr>
      {% for good in goods %}
      <tr>
        <td>{{ good.date_ordered|date:"D, d M Y"}}</td>
        <td>{{ good.item }}</td>
        <td>{{ good.quantity }}</td>
        <td>{{ good.price }}</td>
        <td>
          {% if good.note %}
          <span class="text-blue-800 underline font-bold cursor-pointer" onclick="alert('{{ good.note }}')">{{ good.note|truncatewords:1 }}</span>
          {% else %}
          ---
          {% endif %}
        </td>
      </tr>
      {% endfor %}
      <th>Total</th>
      <td colspan="2"></td>
      <td> &#8358; {{ total|intcomma }}</td>
    </table>
  </div>

  {% endif %}
</div>

<script src="{% static 'js/amcharts.js' %}"></script>
<script>
  const url = "{% url 'chart' %}";
  const goodName = '{{q}}';
  window.onload = loadChart()
</script>
{% endblock %}